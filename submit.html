<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Submit Time Trial</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    background: #02060a;
    color: #e0e6f0;
  }

  .top-nav {
    background: #050b11;
    color: #9cb5d6;
    font-size: 12px;
    padding: 6px 10px;
    text-align: right;
    border-bottom: 1px solid #18202b;
  }
  .top-nav a {
    color: #9cb5d6;
    text-decoration: none;
    margin-left: 8px;
  }
  .top-nav a:hover { text-decoration: underline; }

  .page-header {
    background: #0b1620;
    color: #ffffff;
    padding: 10px 14px;
    border-bottom: 1px solid #202a38;
  }
  .page-header h1 {
    margin: 0;
    font-size: 18px;
  }
  .page-header span {
    font-size: 11px;
    color: #9cb5d6;
  }

  .content-wrap {
    max-width: 600px;
    margin: 16px auto 40px;
    padding: 0 10px;
  }

  .card {
    background: #111c28;
    border: 1px solid #273446;
    padding: 12px 14px 16px;
  }

  label {
    display: block;
    font-size: 12px;
    margin-top: 8px;
    margin-bottom: 2px;
  }

  select, input[type="text"] {
    width: 100%;
    padding: 5px 6px;
    font-size: 13px;
    background: #0b1620;
    color: #e0e6f0;
    border: 1px solid #273446;
  }

  select:focus, input[type="text"]:focus {
    outline: none;
    border-color: #ffe28a;
    box-shadow: 0 0 4px #ffe28a;
  }

  .hint {
    font-size: 11px;
    color: #9cb5d6;
  }

  button {
    margin-top: 10px;
    padding: 6px 10px;
    font-size: 13px;
    background: #203755;
    color: #ffe28a;
    border: 1px solid #374764;
    cursor: pointer;
  }
  button:hover {
    background: #284566;
  }

  .status {
    margin-top: 10px;
    font-size: 12px;
  }
  .status.ok {
    color: #9cff9c;
  }
  .status.err {
    color: #ff8080;
  }
</style>
</head>
<body>

<div class="top-nav">
  <a href="home.html">&laquo; Back to Track List</a>
</div>

<div class="page-header">
  <h1>Submit Time Trial</h1>
  <span>Your time will go into a pending list for verification.</span>
</div>

<div class="content-wrap">
  <div class="card">
    <form id="submitForm">
      <label for="track">Track</label>
      <select id="track" required></select>

      <label for="player">Player name</label>
      <input type="text" id="player" required maxlength="40" />

      <label for="time">Time <span class="hint">(format: M:SS.mmm, e.g. 1:23.456)</span></label>
      <input type="text" id="time" required placeholder="1:23.456" />

      <button type="submit">Submit Time</button>

      <div id="status" class="status"></div>
    </form>
  </div>
</div>

<script>
// === API URL ===
const API_URL = "https://mkds-submit-proxy.zachdashermk.workers.dev/";

// Full track list (same order as index/leaderboard)
const trackNames = [
  "SNES Mario Circuit 1",
  "SNES Donut Plains 1",
  "Beta Donut Plains 1",
  "SNES Ghost Valley 1",
  "SNES Bowser Castle 1",
  "SNES Mario Circuit 2",
  "SNES Choco Island 1",
  "SNES Ghost Valley 2",
  "SNES Donut Plains 2",
  "Beta Donut Plains 2",
  "SNES Bowser Castle 2",
  "SNES Mario Circuit 3",
  "SNES Koopa Beach 1",
  "SNES Choco Island 2",
  "SNES Vanilla Lake 1",
  "SNES Bowser Castle 3",
  "Tour Bowser Castle 3",
  "SNES Mario Circuit 4",
  "SNES Donut Plains 3",
  "SNES Koopa Beach 2",
  "SNES Ghost Valley 3",
  "SNES Vanilla Lake 2",
  "SNES Rainbow Road",
  "SNES Rainbow Road U",
  "N64 Luigi Raceway",
  "N64 Moo Moo Farm",
  "N64 Koopa Troopa Beach",
  "N64 Kalimari Desert",
  "N64 Toad's Turnpike",
  "N64 Frappe Snowland",
  "N64 Choco Mountain",
  "Tour Choco Mountain",
  "N64 Mario Raceway",
  "N64 Wario Stadium",
  "N64 Sherbet Land",
  "N64 Royal Raceway",
  "Wii U Royal Raceway",
  "N64 Bowser's Castle",
  "N64 DK's Jungle Parkway",
  "N64 Yoshi Valley",
  "N64 Banshee Boardwalk",
  "N64 Rainbow Road",
  "GBA Peach Circuit",
  "Tour Peach Circuit",
  "GBA Shy Guy Beach",
  "GBA Riverside Park",
  "Tour Riverside Park",
  "GBA Bowser Castle 1",
  "GBA Mario Circuit",
  "GBA Mario Circuit U",
  "GBA Boo Lake",
  "Tour Boo Lake",
  "GBA Cheese Land",
  "Wii U Cheese Land",
  "GBA Bowser Castle 2",
  "GBA Luigi Circuit",
  "GBA Sky Garden",
  "Tour Sky Garden",
  "GBA Cheep-Cheep Island",
  "Tour Cheep-Cheep Island",
  "GBA Sunset Wilds",
  "Tour Sunset Wilds",
  "GBA Snow Land",
  "Tour Snow Land",
  "GBA Ribbon Road",
  "Wii U Ribbon Road",
  "GBA Yoshi Desert",
  "GBA Bowser Castle 3",
  "GBA Lakeside Park",
  "Tour Lakeside Park",
  "GBA Broken Pier",
  "GBA Bowser Castle 4",
  "GBA Rainbow Road",
  "GBA Rainbow Road DX",
  "GCN Luigi Circuit",
  "GCN Peach Beach",
  "GCN Baby Park",
  "Wii U Baby Park",
  "GCN Dry Dry Desert",
  "Wii U Dry Dry Desert",
  "GCN Mushroom Bridge",
  "GCN Mario Circuit",
  "GCN Daisy Cruiser",
  "GCN Waluigi Stadium",
  "GCN Sherbet Land",
  "Wii U Sherbet Land",
  "GCN Mushroom City",
  "GCN Yoshi Circuit",
  "GCN DK Mountain",
  "GCN Wario Colosseum",
  "GCN Dino Dino Jungle",
  "GCN Bowser's Castle",
  "GCN Rainbow Road",
  "DS Figure 8 Circuit",
  "DS Yoshi Falls",
  "DS Cheep Cheep Beach",
  "DS Luigi's Mansion",
  "DS Desert Hills",
  "DS Delfino Square",
  "Beta Delfino Square",
  "DS Waluigi Pinball",
  "DS Shroom Ridge",
  "SW Shroom Ridge",
  "DS DK Pass",
  "DS Tick-Tock Clock",
  "Wii U Tick-Tock Clock",
  "DS Mario Circuit",
  "DS Airship Fortress",
  "DS Wario Stadium",
  "DS Peach Gardens",
  "DS Bowser Castle",
  "DS Rainbow Road",
  "Wii Luigi Circuit",
  "Wii Moo Moo Meadows",
  "Wii Mushroom Gorge",
  "Wii Toad's Factory",
  "Wii Mario Circuit",
  "Wii Coconut Mall",
  "Wii DK Summit",
  "Tour DK Summit",
  "Wii Wario's Gold Mine",
  "Wii Daisy Circuit",
  "Wii Koopa Cape",
  "Wii Maple Treeway",
  "Wii Grumble Volcano",
  "Wii Dry Dry Ruins",
  "Beta Dry Dry Ruins",
  "Wii Moonview Highway",
  "Wii Bowser's Castle",
  "Wii Rainbow Road",
  "3DS Toad Circuit",
  "3DS Daisy Hills",
  "3DS Cheep Cheep Lagoon",
  "3DS Shy Guy Bazaar",
  "3DS Wuhu Loop",
  "3DS Mario Circuit",
  "3DS Music Park",
  "3DS Rock Rock Mountain",
  "3DS Piranha Plant Slide",
  "3DS Wario's Shipyard",
  "3DS Neo Bowser City",
  "3DS Maka Wuhu",
  "3DS DK Jungle",
  "3DS Rosalina's Ice World",
  "3DS Bowser's Castle",
  "3DS Rainbow Road",
  "Wii U Mario Kart Stadium",
  "Wii U Sweet Sweet Canyon",
  "Wii U Thwomp Ruins",
  "Wii U Mario Circuit",
  "Wii U Toad Harbor",
  "Wii U Twisted Mansion",
  "Wii U Shy Guy Falls",
  "Wii U Dolphin Shoals",
  "Wii U Electrodrome",
  "Wii U Mount Wario",
  "Wii U Cloudtop Cruise",
  "Wii U Bone-Dry Dunes",
  "Wii U Bowser's Castle",
  "Wii U Rainbow Road",
  "Wii U Mute City",
  "Wii U Excitebike Arena",
  "Wii U Hyrule Circuit",
  "Wii U Wild Woods",
  "Wii U Animal Crossing",
  "Wii U Super Bell Subway",
  "Wii U Big Blue",
  "SW Sky-High Sundae",
  "SW Yoshi's Island",
  "Tour Tokyo Blur",
  "Tour Vancouver Velocity",
  "Tour Singapore Speedway",
  "Tour Madrid Drive",
  "Tour Merry Mountain",
  "Tour Ninja Hideaway",
  "RMX Mario Circuit 1",
  "RMX Choco Island 1",
  "RMX Rainbow Road 1",
  "RMX Rainbow Road 2",
  "RMX Vanilla Lake 1",
  "RMX Vanilla Lake 2",
  "RMX Ghost Valley 1",
  "RMX Bowser Castle 1",
  "RMX Donut Plains 1",
  "GP Mario Beach",
  "GP Mario Highway",
  "GP DK Jungle",
  "GP Bananan Ruins",
  "GP Snow Panic",
  "GP Bowser's Castle",
  "GP Castle Wall",
  "GP Rainbow Coaster",
  "GP2 Stadium Arena",
  "SW2 Mario Bros. Circuit",
  "SW2 Whistlestop Summit",
  "SW2 Cheep Cheep Falls",
  "Beta Dokan Course",
  "Beta Nokonoko Beach"
];

const trackSelect = document.getElementById("track");
trackNames.forEach(name => {
  const opt = document.createElement("option");
  opt.value = name;
  opt.textContent = name;
  trackSelect.appendChild(opt);
});

function isValidTime(t) {
  return /^\d{1,2}:\d{2}\.\d{3}$/.test(t);
}

document.getElementById("submitForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const statusEl = document.getElementById("status");
  statusEl.textContent = "";
  statusEl.className = "status";

  const track  = trackSelect.value;
  const player = document.getElementById("player").value.trim();
  const time   = document.getElementById("time").value.trim();

  if (!player || !time) {
    statusEl.textContent = "Please fill in all fields.";
    statusEl.classList.add("err");
    return;
  }

  if (!isValidTime(time)) {
    statusEl.textContent = "Time must be in format M:SS.mmm (e.g. 1:23.456).";
    statusEl.classList.add("err");
    return;
  }

  try {
    const url =
      API_URL +
      "?action=submitPublic" +
      "&track="  + encodeURIComponent(track) +
      "&player=" + encodeURIComponent(player) +
      "&time="   + encodeURIComponent(time);

    const res  = await fetch(url);
    const text = await res.text();

    if (res.ok && text.trim() === "OK") {
      statusEl.textContent = "Time submitted! It will appear after verification.";
      statusEl.classList.add("ok");
    } else {
      statusEl.textContent = "Submission failed: " + (text || res.status);
      statusEl.classList.add("err");
    }
  } catch (err) {
    statusEl.textContent = "Network error while submitting.";
    statusEl.classList.add("err");
  }
});
</script>

</body>
</html>
